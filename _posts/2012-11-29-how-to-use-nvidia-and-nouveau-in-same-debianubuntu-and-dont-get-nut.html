---
layout: post
title: How to use nvidia and nouveau in same debian/ubuntu and don't get nut
date: 2012-11-29 23:40:46.000000000 +01:00
categories:
- Cuaderno de bitácora
- Hallazgos
- Tecnicismos
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
author:
  login: txomon
  email: txomon1@gmail.com
  display_name: txomon
  first_name: ''
  last_name: ''
---
<p>Buenas a los que sea que me leáis,</p>
<p>Estoy escribiendo esto para que le sirva como una referencia a cualquiera, lo traduciría a ingles... de hecho igual lo escribo en ingles.</p>
<p>I am going to explain how we can get nvidia driver and nouveau driver working in the same debian installation. I needed this because in the actual testing kernel (wheezy 3.2) my graphic card isn't supported, and the nvidia driver has a bug when trying to start maya.</p>
<p>Whatever you are here for, this is how:</p>
<p>We all start with running nouveau driver, if you have very bad luck like I had, your system after installation doesn't even boot. I switched to nomodeset run going to the grub menu entry (on boot) and adding in the linux line at the end (after quiet)</p>
<blockquote>
<pre>nomodeset</pre>
</blockquote>
<p>after that, I was able to boot. With that, I followed <a href="http://wiki.debian.org/NvidiaGraphicsDrivers#Installation-1">http://wiki.debian.org/NvidiaGraphicsDrivers</a>  in the debian way installation. After that, and getting nut on how to create a xorg.conf file:</p>
<blockquote>
<pre>nvidia-xconfig -o xorg.conf</pre>
</blockquote>
<p>Yes, i know it was easy, but I started to read about a lot of solutions, and messed up. The idea is that after having the xorg.conf created, and in /etc/X11, I got it running.</p>
<p>I just rebooted and it worked.</p>
<p>Then, I found the bug that it didn't allow me to open maya files (SIGSEGV in their libGl1.so dll)</p>
<p>So I decided to go for a newer kernel (v3.6[1])  which also I had patched for work reasons, and compiled it. Well, you all must get aware that if you make a menuconfig, you <strong>have to be aware of enabling graphic drivers</strong>. I mean, go to graphic drivers, and remember to enable them:</p>
<blockquote>
<pre>Graphics support ---&gt;</pre>
<pre style="padding-left: 30px;">&lt;M&gt; Direct Rendering Manager (XFree86 4.1.0 and higher DRI support)  ---&gt;</pre>
<pre style="padding-left: 60px;">&lt;M&gt;   Nouveau (nVidia) cards</pre>
<pre style="padding-left: 60px;">[*]     Support for backlight control #optional</pre>
<pre style="padding-left: 60px;">[*]     Build in Nouveau's debugfs support #optional but if you encounter errors, its easier like this to send bugs</pre>
<pre style="padding-left: 30px;">{*} Support for frame buffer devices  ---&gt;</pre>
<pre style="padding-left: 60px;">&lt;M&gt;   nVidia Framebuffer Support # I saw this and enabled it just in case</pre>
<pre style="padding-left: 90px;">[*]     Enable DDC Support #same</pre>
<pre style="padding-left: 90px;">[*]     Lots of debug output #same</pre>
<pre style="padding-left: 90px;">[*]     Support for backlight control #same</pre>
</blockquote>
<p>&nbsp;</p>
<p>I forgot to enable the first section (the real important in which you enable the driver nouveau) because I didn't think about the meaning of  Direct Rendering Manager, neither knew it was important, etc. So the case is I compiled and installed, and now I had the problem:</p>
<p>How to switch between one and the other? the installation following the Debian wiki didn't allow me to use nouveau if I didn't uninstall nvidia one. So I started to research about it, asked a lot in #debian #debian-next etc. And babilen told me that the only thing that said xorg to use nvidia, was that xorg.conf file.</p>
<p>So from there, the solution was simple, to switch from nvidia to nouveau:</p>
<pre style="padding-left: 30px;">mv /etc/X11/xorg.conf /etc/X11/xorg.conf.nvidia</pre>
<pre style="padding-left: 30px;">vim /etc/modprobe.d/nvidia-kernel-common.conf # here comment all the lines and add a line that blacklists nvidia ( blacklist nvidia )</pre>
<pre style="padding-left: 30px;">update-alternatives --config glx #choose mesa</pre>
<p>And now, you can reboot into nouveau. To change from nouveau to nvidia, mv the xorg.conf, unblacklist nvidia and blacklist nouveau (what you commented) and restore the other lines you commentes, and finally use update-alternatives command to use nvidia one. And reboot.</p>
<p>I hope it helps anyone, just to not keep installing/uninstalling the nvidia driver.</p>
<p>Cheers to anyone that really needs, and if you need help, I can help you, contact me on twitter (@txomon), or find my mail somewhere :D tip: &lt;domain&gt;@&lt;domain&gt;.com =) ]</p>
<p>[1]: if I say a kernel is v3.6, its from linus' repo, if I say it is 3.6, it is from linux-stable repo (they are different)</p>
